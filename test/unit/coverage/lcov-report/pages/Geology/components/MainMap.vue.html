<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for pages/Geology/components/MainMap.vue</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\..\index.html">All files</a> / <a href="index.html">pages/Geology/components</a> MainMap.vue
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">&lt;template&gt;
  &lt;div id="map" class="map" style="width:100%;height:100%;pointer-events: ;"&gt;
    &lt;div
      class="popup"
      ref="popup"
      v-show="currentCoordinate"&gt;
      &lt;span class="icon-close" @click="closePopup"&gt;x&lt;/span&gt;
      &lt;div class="content"&gt;{{currentCoordinate}}&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
<span class="cstat-no" title="statement not covered" >import 'ol/ol.css'</span>
<span class="cstat-no" title="statement not covered" >import Map from 'ol/Map'</span>
// import OSM from 'ol/source/OSM'
<span class="cstat-no" title="statement not covered" >import TileLayer from 'ol/layer/Tile'</span>
<span class="cstat-no" title="statement not covered" >import Overlay from 'ol/Overlay'</span>
<span class="cstat-no" title="statement not covered" >import { toStringHDMS } from 'ol/coordinate'</span>
<span class="cstat-no" title="statement not covered" >import XYZ from 'ol/source/XYZ'</span>
<span class="cstat-no" title="statement not covered" >import View from 'ol/View'</span>
<span class="cstat-no" title="statement not covered" >import { GEOLOGY_LIST_DATA } from '../../../constant/index.js'</span>
&nbsp;
export default {
<span class="fstat-no" title="function not covered" >  data () {</span>
<span class="cstat-no" title="statement not covered" >    return {</span>
      map: {},
      overlay: null,
      currentCoordinate: null, // 弹窗
      mapdata: GEOLOGY_LIST_DATA
    }
  },
  props: ['nodeid', 'nodedif'],
  methods: {
<span class="fstat-no" title="function not covered" >    initMap () {</span>
<span class="cstat-no" title="statement not covered" >      console.log('map：+++++++++++++++++++++', this.nodeid, this.nodedif)</span>
<span class="cstat-no" title="statement not covered" >      var wmsLayer = new TileLayer({</span>
        source: new XYZ({
          url: 'http://mt3.google.cn/vt/lyrs=s&amp;hl=zh-CN&amp;gl=cn&amp;x={x}&amp;y={y}&amp;z={z}'
        })
      })
      // 隐藏图层
      // wmsSource.setVisible(false)
      // this.mapdata.BasinSource.setVisible(false)
      // this.mapdata.LakeSource.setVisible(false)
      // this.mapdata.RiversSource.setVisible(false)
      // 删除图层
<span class="cstat-no" title="statement not covered" >      this.overlay = new Overlay({</span>
        element: this.$refs.popup, // 弹窗标签, 在 html 里
        autoPan: true, // 如果弹窗在底图边缘时, 底图会移动
        autoPanAnimation: { // 底图移动动画
          duration: 250
        }
      })
<span class="cstat-no" title="statement not covered" >      this.map = new Map({</span>
        layers: [wmsLayer, this.mapdata.wmsSource, this.mapdata.BasinSource, this.mapdata.LakeSource, this.mapdata.RiversSource],
        target: 'map',
        overlays: [this.overlay],
        view: new View({
          projection: 'EPSG:4326',
          center: [104.383889, 30.605000],
          zoom: 10.5,
          maxZoom: 10.5,
          minZoom: 10.5
        })
      })
<span class="cstat-no" title="statement not covered" >      this.map.removeLayer(this.mapdata.wmsSource)</span>
<span class="cstat-no" title="statement not covered" >      console.log('init finished')</span>
<span class="cstat-no" title="statement not covered" >      console.log(this.map)</span>
<span class="cstat-no" title="statement not covered" >      this.mapClick(this.mapdata.wmsSource)</span>
    },
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >    mapClick (source) {</span></span>
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >      this.map.on('singleclick', evt =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >        console.log(evt.coordinate)</span>
<span class="cstat-no" title="statement not covered" >        const coordinate = evt.coordinate // 获取坐标</span>
<span class="cstat-no" title="statement not covered" >        const hdms = toStringHDMS(coordinate) // 转换坐标格式</span>
<span class="cstat-no" title="statement not covered" >        console.log(coordinate)</span>
<span class="cstat-no" title="statement not covered" >        this.currentCoordinate = hdms // 保存坐标点</span>
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >        setTimeout(() =&gt; {</span></span>
          // 设置弹窗位置
          // 这里要设置定时器, 不然弹窗首次出现, 底图会跑偏
<span class="cstat-no" title="statement not covered" >          this.overlay.setPosition(coordinate)</span>
        }, 0)
        // this.map.removeLayer(source)
<span class="cstat-no" title="statement not covered" >        this.map.addLayer(source)</span>
      })
    },
<span class="fstat-no" title="function not covered" >    closePopup () {</span>
      // 把弹窗位置设置为 undefined, 并清空坐标数据
<span class="cstat-no" title="statement not covered" >      this.overlay.setPosition(undefined)</span>
<span class="cstat-no" title="statement not covered" >      this.currentCoordinate = null</span>
<span class="cstat-no" title="statement not covered" >      this.map.removeLayer(this.mapdata.wmsSource)</span>
    }
  },
<span class="fstat-no" title="function not covered" >  mounted () {</span>
<span class="cstat-no" title="statement not covered" >    this.initMap()</span>
  }
}
&lt;/script&gt;
&lt;style lang="scss" scoped&gt;
  .popup {
    min-width: 280px;
    position: relative;
    background: #fff;
    padding: 8px 16px;
    display: flex;
    flex-direction: column;
    transform: translate(-50%, calc(-100% - 12px));
    /* 弹窗下方的小三角形 */
    &amp;::after {
      display: block;
      content: '';
      width: 0;
      height: 0;
      position: absolute;
      border: 12px solid transparent;
      border-top-color: #fff;
      bottom: -23px;
      left: 50%;
      transform: translateX(-50%);
    }
  }
  /* 关闭弹窗按钮 */
  .icon-close {
    cursor: pointer;
    align-self: flex-end;
    margin-bottom: 10px;
  }
&lt;/style&gt;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Tue Nov 03 2020 15:02:50 GMT+0800 (GMT+08:00)
</div>
</div>
<script src="..\..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\..\sorter.js"></script>
</body>
</html>
